# 进销存智能 BI 系统 - 功能需求文档 (PRD)

## 1. 项目背景
[cite_start]本项目旨在构建一个智能化的 BI 数据分析系统，解决传统报表开发周期长、灵活性差的问题。核心是通过 AI (Text-to-SQL) 实现“按需自行设置分析报表” [cite: 12]。

## 2. 数据模型与维度
系统需基于进销存逻辑，处理以下核心数据对象：
* [cite_start]**维度 (Dimensions)**：分公司、部门、职员 (业务员)、仓库、往来单位 (客户/供应商)、地区、商品 [cite: 19]。
* [cite_start]**指标 (Metrics)**：销售额、成本、毛利、费用发生额、往来余额 (应收/应付)、库存数量/金额 [cite: 19, 14]。

## 3. 功能模块详情

### 3.1 数据接入与处理 (Backend)
* **数据源**：连接 MySQL/PostgreSQL 业务数据库。
* **宽表视图**：后端需构建 `view_sales_analysis`, `view_inventory_snapshot`, `view_finance_flow` 等视图，简化 AI 查询逻辑。
* **向量化 (ETL)**：定期将数据库 Schema、数据字典、以及常用 SQL 问答对同步至向量数据库 (pgvector)，供 AI 检索。

### [cite_start]3.2 智能问答模块 (ChatBI) [cite: 12]
* **自然语言转 SQL**：
    * 用户输入自然语言问题。
    * 系统调用 Vanna.ai + LLM 生成 SQL。
    * **要求**：优先查询 Redis 缓存，减少 Token 消耗。
* **智能图表推荐**：
    * 后端返回数据时，需根据数据特征（如：时间序列、分类占比）推荐合适的 ECharts 图表类型（Line, Bar, Pie）。
* **结果呈现**：
    * 前端同时展示：SQL 语句 (可选, 用于调试)、自然语言总结、可视化图表、原始数据表格。

### [cite_start]3.3 经营驾驶舱 (Dashboard) [cite: 24]
* **默认看板**：系统内置一套标准看板。
* **数据实时性**：KPI 指标需展示最后更新时间。
* **下钻分析**：点击某个图表区域（如“华东区”柱子），跳转到详情页并自动带入筛选条件。

### [cite_start]3.4 报表查询与导出 [cite: 21, 23]
* **通用查询**：支持按所有维度进行组合筛选。
* **表格功能**：支持列排序、列汇总（Sum/Avg）。
* **导出**：支持当前查询结果导出为 Excel (`.xlsx`) 文件。

### 3.5 系统管理
* [cite_start]**权限控制 (RBAC)** [cite: 17]：
    * 管理员：可查看所有数据，配置 AI 模型。
    * 分公司经理：只能查看本分公司数据（Row-Level Security 数据行级权限）。
    * 普通员工：仅查看个人数据。

## 4. 非功能需求
* **响应速度**：简单查询 SQL 生成 < 3秒，图表渲染 < 1秒。
* **准确率**：经过训练后的 AI 查询准确率需 > 90%。
* **浏览器兼容**：Chrome, Edge, Safari (最近 2 个版本)。